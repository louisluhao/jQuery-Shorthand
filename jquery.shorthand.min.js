/*!
 *	jQuery Shorthand v0.1.0
 *
 *	Copyright (c) 2010 Knewton
 *	Dual licensed under:
 *		MIT: http://www.opensource.org/licenses/mit-license.php
 *		GPLv3: http://www.opensource.org/licenses/gpl-3.0.html
 */
(function($){var RX_CLASSES=/\.[a-zA-Z_\-]+/g,RX_ID=/#[a-zA-Z_\-]+/,RX_ELEMENT=/^[a-zA-Z0-9]+/,RX_CLEAN_CLASSES=/\./g,RX_FUNCTION=/^[a-zA-Z_]+/,RX_SCOPE=/::/,ATTRIBUTE_BLACKLIST=["class","style","id"],TEXT_NODE=3,_$$=window.$$,parseShorthand;function typecheck(type,compare){return!type?false:!type.constructor?false:type.constructor.toString().match(new RegExp(compare+"\\(\\)","i"))!==null}function evaluate(value,strict){var chain=window;if(typecheck(value,"Array")||typecheck(value,"Object")){$.each(value,
function(index,item){value[index]=evaluate(item,strict)});return value}if(!typecheck(value,"String"))return value;$.each(value.split(RX_SCOPE),function(index,scope){if(!chain[scope])return;else chain=chain[scope]});return typecheck(chain,"Function")?chain:strict?false:function(){}}function processFunctionalCommands(element,functional){$.each(functional,function(command,args){command=command.match(RX_FUNCTION)[0];if(!typecheck($.fn[command],"Function"))return;if(typecheck(args,"String"))$.fn[command].call(element,
evaluate(args));else if(typecheck(args,"Function"))$.fn[command].call(element,args);else if(typecheck(args,"Array")){$.each(args,function(index,arg){args[index]=evaluate(arg,true)||arg});$.fn[command].apply(element,args)}else if(args===undefined)$.fn[command].call(element);else return})}function createElement(shorthand){var tag=shorthand.match(RX_ELEMENT),id=shorthand.match(RX_ID),classes=shorthand.match(RX_CLASSES),element;if(tag===null)return $();element=$(document.createElement(tag[0]));if(classes!==
null)element.addClass(classes.join(" ").replace(RX_CLEAN_CLASSES,""));if(id!==null)element.attr("id",id[0].substr(1));return element}function createComplexElement(elementShorthand,shorthand){var element=createElement(elementShorthand),attributes,text,children;$.each(shorthand,function(index,value){if(typecheck(value,"Object"))attributes=value;else if(typecheck(value,"Array"))children=value;else if(typecheck(value,"String"))text=value});if(attributes!==undefined){if(attributes._!==undefined){element.css(attributes._);
delete attributes._}if(attributes.$!==undefined){processFunctionalCommands(element,attributes.$);delete attributes.$}element.attr(attributes)}if(text!==undefined)element.html(decodeURIComponent(text));if(children!==undefined)$.each(parseShorthand.apply(parseShorthand,children),function(index,child){element.append(child)});return element}function createSiblings(tree){var elements=[];$.each(parseShorthand.apply(parseShorthand,tree),function(index,element){elements.push(element[0])});return $(elements)}
function createGroup(tag,definitions){var elements=[];$.each(definitions,function(index,shorthand){elements.push(createComplexElement(tag,shorthand)[0])});return $(elements)}function serializeFullObject(element){var response=[],attributes={},styles={},text,html=element[0];$.each(html.attributes,function(index,attribute){if($.inArray(attribute.name,ATTRIBUTE_BLACKLIST)!==-1)return;attributes[attribute.name]=attribute.value});$.each(html.style,function(index,style){styles[style]=element.css(style)});
if(!$.isEmptyObject(styles))attributes._=styles;$.each(html.childNodes,function(index,child){if(child.nodeType===TEXT_NODE){if(text===undefined)text="";text+=encodeURIComponent(child.nodeValue)}});if(!$.isEmptyObject(attributes))response.push(attributes);if(text!==undefined)response.push(text);return response}function serialize(elements,fullObject,fullTree){var response=[];elements.each(function(){var element=$(this),shorthand=this.nodeName.toLowerCase(),item;if(this.id.length>0)shorthand+="#"+this.id;
if(this.className.length>0)shorthand+="."+this.className.replace(" ",".");if(fullObject){item=[shorthand];item=item.concat(serializeFullObject(element))}if(fullTree){if(item===undefined)item=[shorthand];if(element.children().length>0)item.push(serialize(element.children(),fullObject,fullTree))}if(item===undefined)item=shorthand;response.push(item)});return response}parseShorthand=function(){var elements=[];$.each(Array.prototype.slice.apply(arguments),function(index,shorthand){if(typeof shorthand===
"string")elements.push(createElement(shorthand));else if($.isArray(shorthand))if(shorthand.length===0)return;else if($.isArray(shorthand[0]))elements.push(createSiblings(shorthand));else if(typeof shorthand[0]==="string")if(shorthand[0].substr(0,1)==="&")elements.push(createGroup(shorthand.shift().substr(1),shorthand));else elements.push(createComplexElement(shorthand.shift(),shorthand));else return});return elements.length===1?elements[0]:elements};parseShorthand.noConflict=function(){window.$$=
_$$;return parseShorthand};$.fn.toShorthand=function(fullObject,fullTree){var shorthand=serialize(this,fullObject,fullTree);return shorthand.length===1?shorthand[0]:shorthand};$.shorthand=parseShorthand;window.$$=parseShorthand})(jQuery);
